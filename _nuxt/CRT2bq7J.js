import{_ as g}from"./M5XCSj9R.js";import{_ as b,c as d,b as i,d as f,t as l,n as u,F as E,r as F,T as h,E as v,S as x,o as c}from"./DtuJD_1a.js";const _={tagName:"form-attachments",data(){return{isDragging:!1,hasError:!1,filesLength:0,files:null}},computed:{filesList(){var t;if(!((t=this.files)!=null&&t.files))return null;const e=Array.from(this.files.files);return this.filesLength>this.maxFilesValue?e.slice(0,this.maxFilesValue):e},classList(){return["form-attachments",this.hasError===!0?"has-error":"",this.isDragging?x.DRAGGING:"","vue-component"]},interactableClassList(){return["form-attachments__interactable",this.hasErrors?x.HAS_ERROR:""]},requiredValue(){return this.required?"required":null},maxSizeMb(){return this.maxSize/1e6},maxFilesValue(){return this.maxFiles?this.maxFiles:5},extensionList(){const e=this.extensions.map(t=>h.capitalize(t));return e==null?void 0:e.join(", ")},extensionListText(){return`${this.extensionList} max. ${this.maxSizeMb} MB`},acceptList(){return this.extensions.map(e=>`.${e}`).join(",")}},props:{hasError:{default:null},maxSize:Number,description:String,text:String,requiredMsg:{default:null},required:{default:null},extensions:Array,id:String,maxFiles:Number},mounted(){var e,t;this.files=new DataTransfer,this.root=this.$refs.root,this.interactable=this.$refs.interactable,this.button=this.$refs.button,this.textElement=this.$refs.text,this.file=this.$refs.file,this.error=this.$refs.error,this.base64=this.$refs.base64,this.bindEvents(),(t=(e=window.i18n)==null?void 0:e.loader)==null||t.then(()=>{var s,a,n;this.wrongTypeText=(s=window.i18n)==null?void 0:s.translate("formAttachmentsWrongType"),this.maxFilesText=(a=window.i18n)==null?void 0:a.translate("formAttachmentsMaxFiles",this.maxFilesValue),this.maxSizeText=(n=window.i18n)==null?void 0:n.translate("formAttachmentsMaxSize")})},methods:{bindEvents(){this.interactable.addEventListener("drag",this.handleDragStart.bind(this)),this.interactable.addEventListener("dragstart",this.handleDragStart.bind(this)),this.interactable.addEventListener("dragover",this.handleDragOver.bind(this)),this.interactable.addEventListener("dragenter",this.handleDragOver.bind(this)),this.interactable.addEventListener("drop",this.handleDrop.bind(this)),this.interactable.addEventListener("dragleave",this.handleDrop.bind(this)),this.interactable.addEventListener("dragend",this.handleDrop.bind(this)),this.interactable.addEventListener("click",this.handleAddAttachment.bind(this)),document.addEventListener(v.FORM_ATTACHMENT_ERROR,this.handleFormAttachmentError.bind(this));const e=h.getParent(this.root,"form");e&&e.addEventListener("reset",this.reset.bind(this))},handleFormAttachmentError(e){this.showError(this.maxSizeText)},handleDragStart(e){e.preventDefault(),e.stopPropagation()},handleDragOver(e){e.preventDefault(),e.stopPropagation(),window.clearTimeout(this.dropTimeout),this.isDragging=!0},handleDrop(e){var s;e.preventDefault(),e.stopPropagation();const t=(s=e==null?void 0:e.dataTransfer)==null?void 0:s.files;this.dropTimeout=window.setTimeout(()=>{this.isDragging=!1,e.type==="drop"&&this.handleDroppedFiles(t)},50)},isAllowedFileExtension(e){var n;if(!e)return;const t=(n=this.file.getAttribute("accept"))==null?void 0:n.toLowerCase(),s=(t==null?void 0:t.split(","))||[],a=h.getExtension(e.name);return s.includes(`.${a}`)},isUnderMaxSize(e){if(!(!e||!e.size))return e.size<=this.maxSize},handleDroppedFiles(e){const t=this.getErrors(e);if(t)return this.showError(t);this.appendDroppedFiles(e)},handleAddAttachment(){this.file.click()},restoreDataTransfer(){this.file.files=this.files.files},showError(e){this.restoreDataTransfer(),this.setErrorText(e),this.hasError=!0},setErrorText(e){this.error&&(this.error.innerText=e)},reset(){this.file.files=null,this.files=new DataTransfer,this.resetError()},resetError(){this.setErrorText(this.requiredMsg),this.hasError=!1},appendDroppedFiles(e){this.base64&&(this.isRequired&&(this.file.required=!1),this.appendFiles(e))},areFilesAllowed(e){return Array.from(e).every(t=>this.isAllowedFileExtension(t))},getErrors(e){if(!this.areFilesAllowed(e))return this.wrongTypeText;if(this.files.files.length+e.length>this.maxFilesValue)return this.maxFilesText;if(!Array.from(e).every(t=>this.isUnderMaxSize(t)))return this.maxSizeText},appendFiles(e){if(this.files.files.length>=this.maxFilesValue)return this.showError(this.maxFilesText);Array.from(e).forEach(t=>{this.files.items.add(t)}),this.syncFiles()},syncFiles(){this.filesLength=this.files.items.length,this.file.files=this.files.files,this.resetError()},handleChange(e){var a;const t=(a=e==null?void 0:e.target)==null?void 0:a.files,s=this.getErrors(t);if(s)return this.showError(s);this.appendFiles(t)},handleClick(e){this.files.files[e]&&(this.files.items.remove(e),this.syncFiles())},toSize(e){return h.toSize(e)}}},T=["data-max-size","data-max-files"],w={class:"form-attachments__button",ref:"button"},y={class:"form-attachments__content"},D={class:"form-attachments__description"},L={class:"form-attachments__extensions"},S={class:"form-attachments__files"},A=["required","id","name","accept"],z={type:"hidden",class:"form-attachments__base64",ref:"base64"},M={class:"form-attachments__files-list"},q={class:"form-attachments__files-list-item"},V={class:"form-attachments__file-details"},C={class:"form-attachments__file-size"};function k(e,t,s,a,n,r){const m=g;return c(),d("div",{class:u(r.classList),"data-max-size":s.maxSize,"data-max-files":r.maxFilesValue,ref:"root"},[i("div",{class:u(r.interactableClassList),ref:"interactable"},[i("div",w,[f(m,{icon:"close",circle:"true",hover:"true",padding:10})],512),i("div",y,[i("div",D,l(s.description),1),i("div",{class:"form-attachments__text",ref:"text"},l(s.text),513),i("div",{class:"form-attachments__error is-error",ref:"error"},l(s.requiredMsg),513),i("div",L,l(r.extensionListText),1)])],2),i("div",S,[i("input",{type:"file",class:"form-attachments__file",ref:"file",multiple:"",required:r.requiredValue,id:s.id,name:s.id,accept:r.acceptList,onChange:t[0]||(t[0]=(...o)=>r.handleChange&&r.handleChange(...o))},null,40,A),i("input",z,null,512),i("div",M,[(c(!0),d(E,null,F(r.filesList,(o,p)=>(c(),d("div",q,[i("span",V,l(o.name),1),i("span",C,"("+l(r.toSize(o.size))+")",1),f(m,{class:"form-attachments__delete",size:"small",icon:"bin",onClick:N=>r.handleClick(p)},null,8,["onClick"])]))),256))])])],10,T)}const j=b(_,[["render",k]]);_.__docgenInfo={exportName:"default",displayName:"form-attachments",description:"",tags:{},props:[{name:"hasError",type:{name:"object"},defaultValue:{func:!1,value:"null"}},{name:"maxSize",type:{name:"number"}},{name:"description",type:{name:"string"}},{name:"text",type:{name:"string"}},{name:"requiredMsg",type:{name:"object"},defaultValue:{func:!1,value:"null"}},{name:"required",type:{name:"object"},defaultValue:{func:!1,value:"null"}},{name:"extensions",type:{name:"array"}},{name:"id",type:{name:"string"}},{name:"maxFiles",type:{name:"number"}}],sourceFiles:["/home/runner/work/c4a8-web-shared-components/c4a8-web-shared-components/nuxt/components/form-attachments.vue"]};export{j as F};
