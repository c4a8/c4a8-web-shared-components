import{D as x}from"./B_dFebf0.js";import{T}from"./DWf-mMkK.js";import{_ as D}from"./Bmj4dfBP.js";import{_ as A}from"./ByOh3em7.js";import{_ as I,c,b as d,d as g,a as C,F as f,r as m,g as V,t as B,S as P,T as p,U as E,o as a,e as b,m as z,n as N}from"./BtoxClPH.js";import{u as w}from"./DtETzEDk.js";const v={tagName:"filter-bar",computed:{hasNoAspectRatio(){if(this.onlyView)return!0},flatSelections(){return this.selections.flat()},storedItems(){return w().getBlogItems},normalizedItems(){return this.storedItems.slice(this.itemStartPoint).map(e=>(e.lang!==this.locale&&(e.externalLanguage=p.getExternalLanguageText(this.locale,e.lang,this.$t)),{...e,blogtitlepic:`${e.blog_image_path||""}${e.blogtitlepic}`,footer:typeof e.footer=="string"?e.footer:void 0}))},filteredItems(){if(!this.selections.length)return this.maxBlogPosts?this.normalizedItems.slice(0,this.maxBlogPosts):this.normalizedItems;let e=[];return this.selections.forEach(t=>{t.forEach(s=>{this.filterDropdowns.forEach(i=>{const o=i.key,r=this.normalizedItems.filter(h=>Array.isArray(h[o])?h[o].includes(s.value):h[o]===s.value);e=[...e,...r]})})}),this.getMaxItems(e)},authors(){return this.extractPropertyCounts("author")},topics(){return this.extractPropertyCounts("categories")},tags(){return this.extractPropertyCounts("tags")},dropdownCollection(){return[this.authors,this.topics,this.tags]}},setup(){const{locale:e}=E();return{locale:e}},created(){const e=w();e.setBlogItems(this.items),e.setBlogView(this.activeView)},beforeMount(){this.activeView=this.onlyView?this.onlyView:this.defaultView;const e={author:{label:this.$t("filterAuthors"),items:this.authors,key:"author",condition:()=>this.authors.length>0},categories:{label:this.$t("filterTopics"),items:this.topics,key:"categories",condition:()=>!0},tags:{label:this.$t("filterTags"),items:this.getFilteredTags(),key:"tags",filterable:!0,condition:()=>!0}};this.filterDropdowns=this.enabledDropdowns.filter(t=>e[t]&&e[t].condition()).map(t=>{const s=e[t];return{label:s.label,items:s.items,key:s.key,...s.filterable&&{filterable:s.filterable}}})},mounted(){window.addEventListener("resize",this.handleResize),this.handleResize()},beforeDestroy(){window.removeEventListener("resize",this.handleResize)},methods:{getFilteredTags(){var i;const e=p.getHash();if(!e)return this.tags;const t=(i=decodeURIComponent(e.substring(1)))==null?void 0:i.toLowerCase();return this.tags.map(o=>{var r;return((r=o==null?void 0:o.text)==null?void 0:r.toLowerCase())===t?(this.addTagToSelection(o),{...o,checked:!0}):o})},addTagToSelection(e,t){const s=t||this.dropdownCollection.length-1;this.selections[s]=[e]},getMaxItems(e){return e=[...new Set(e)],this.maxBlogPosts?e.slice(0,this.maxBlogPosts):e},handleResize(){this.itemStartPoint=p.isUpperBreakpoint()&&this.hasHighlight?1:0},extractPropertyCounts(e){return this.normalizedItems.reduce((s,i)=>(Array.isArray(i[e])?i[e].forEach(o=>{this.updatePropertyCount(s,o)}):i[e]&&this.updatePropertyCount(s,i[e]),s),[]).sort((s,i)=>s.text.localeCompare(i.text))},updatePropertyCount(e,t){const s=e.find(i=>{var o;return((o=i==null?void 0:i.text)==null?void 0:o.toLowerCase())===(t==null?void 0:t.toLowerCase())});s?s.count+=1:e.push({text:t,value:t,count:1})},handleView(e){this.activeView=e,w().setBlogView(this.activeView)},toggleIconClasses(e){return["filter-bar__toggle-icon",e===this.activeView?P.ACTIVE:""]},isArrayEmpty(e){return!Object.keys(e).length},isArrayEmptyRecursive(e){for(let t=0;t<e.length;t++){const s=e[t];if(s&&!this.isArrayEmpty(s))return!1}return!0},handleCardTagClicked(e){this.clearAllSelections(),this.getTagByName(e.toLowerCase())},getTagByName(e){this.tags.map(t=>{if(t.text.toLowerCase()===e){const s=this.filterDropdowns.length-1;this.addTagToSelection(t,s),this.updateDropdownSelection([t],s),this.hasClickedOnTag=!0}})},handleDropdownChange(e,t){e.length===0?this.selections[t]&&delete this.selections[t]:(this.hasClickedOnTag&&(this.hasClickedOnTag=!1,this.selections[t]=[]),this.selections[t]=e),this.isArrayEmptyRecursive(this.selections)&&(this.selections=[])},handleDropdownOpened(e){this.$refs.dropdowns.forEach(t=>{t!==e&&(t.isOpen=!1)})},clearAllSelections(){this.selections=[],this.$refs.dropdowns.forEach(e=>{e.isOpen=!1,e.activeSelection=[]})},removeSelection(e,t){if(e.preventDefault(),this.selections=this.selections.map(i=>i.filter(o=>o.value!==t.value)),this.selections.forEach((i,o)=>{this.updateDropdownSelection(i||[],o)}),this.selections.filter(i=>i.length>0).length===0)return this.clearAllSelections()},updateDropdownSelection(e,t){const s=this.$refs.dropdowns[t];s&&(s.activeSelection=e)}},data(){return{activeView:"",views:["tile-view","list-view"],filterDropdowns:[],selections:[],itemStartPoint:0,hasClickedOnTag:!1}},props:{spacing:String,items:Array,maxBlogPosts:Number,dataAuthors:Object,defaultView:{type:String,default:"tile-view"},onlyView:{type:String},hasHighlight:{type:Boolean,default:!0},enabledDropdowns:{type:Array,default:()=>["author","categories","tags"]}}},O={class:"filter-bar"},L={class:"filter-bar__controls"},R={class:"filter-bar__selection"},F={class:"filter-bar__dropdowns"},H={class:"filter-bar__tags"},j={key:0,class:"filter-bar__views"},M={class:"filter-bar__toggle"},U=["onClick"];function q(e,t,s,i,o,r){var y;const h=x,S=T,_=D,k=A;return a(),c("div",O,[d("div",L,[d("div",R,[d("div",F,[(a(!0),c(f,null,m(o.filterDropdowns,(n,l)=>(a(),b(h,z({ref_for:!0},n,{onDropdownChanged:u=>r.handleDropdownChange(u,l),onDropdownOpened:r.handleDropdownOpened,ref_for:!0,ref:"dropdowns","has-animation":!0,key:l,index:l}),null,16,["onDropdownChanged","onDropdownOpened","index"]))),128))]),d("div",H,[(a(!0),c(f,null,m(r.flatSelections,(n,l)=>(a(),b(S,{class:"filter-bar__tag",tag:n.text,key:l,variant:"icon",onClick:u=>r.removeSelection(u,n)},null,8,["tag","onClick"]))),128)),r.flatSelections.length>=2?(a(),c("a",{key:0,class:"filter-bar__reset",onClick:t[0]||(t[0]=(...n)=>r.clearAllSelections&&r.clearAllSelections(...n))},[g(_,{icon:"close",size:"xs"}),V(" "+B((y=e.translationData)==null?void 0:y.clearAll),1)])):C("",!0)])]),s.onlyView?C("",!0):(a(),c("div",j,[d("div",M,[(a(!0),c(f,null,m(o.views,(n,l)=>(a(),c("div",{class:N(r.toggleIconClasses(n)),onClick:u=>r.handleView(n),key:l},[g(_,{icon:n,size:"small"},null,8,["icon"])],10,U))),128))])]))]),g(k,{items:r.filteredItems,view:o.activeView,"data-authors":s.dataAuthors,"has-no-aspect-ratio":r.hasNoAspectRatio,onCardTagClicked:r.handleCardTagClicked},null,8,["items","view","data-authors","has-no-aspect-ratio","onCardTagClicked"])])}const Y=I(v,[["render",q]]);v.__docgenInfo={exportName:"default",displayName:"filter-bar",description:"",tags:{},props:[{name:"spacing",type:{name:"string"}},{name:"items",type:{name:"array"}},{name:"maxBlogPosts",type:{name:"number"}},{name:"dataAuthors",type:{name:"object"}},{name:"defaultView",type:{name:"string"},defaultValue:{func:!1,value:"'tile-view'"}},{name:"onlyView",type:{name:"string"}},{name:"hasHighlight",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"enabledDropdowns",type:{name:"array"},defaultValue:{func:!1,value:"['author', 'categories', 'tags']"}}],sourceFiles:["/home/runner/work/c4a8-web-shared-components/c4a8-web-shared-components/nuxt/components/filter-bar.vue"]};export{Y as F};
