import{D as y}from"./u0IZBEdW.js";import{T as x}from"./9xbgbIQr.js";import{_ as T}from"./ADyka6Uw.js";import{G as D}from"./Clsrsosx.js";import{_ as I,c,b as h,d as u,F as m,r as f,a as A,g as B,t as P,S as E,T as p,R as z,o as a,e as v,m as L,n as O}from"./CWD2zF1T.js";import{u as _}from"./CLx0-de1.js";const b={tagName:"filter-bar",computed:{flatSelections(){return this.selections.flat()},storedItems(){return _().getBlogItems},normalizedItems(){return this.storedItems.slice(this.itemStartPoint).map(e=>(e.lang!==this.locale&&(e.externalLanguage=p.getExternalLanguageText(this.locale,e.lang,this.$t)),{...e,blogtitlepic:`${e.blog_image_path||""}${e.blogtitlepic}`}))},filteredItems(){if(!this.selections.length)return this.maxBlogPosts?this.normalizedItems.slice(0,this.maxBlogPosts):this.normalizedItems;let e=[];return this.selections.forEach(t=>{t.forEach(s=>{this.filterDropdowns.forEach(r=>{const o=r.key,i=this.normalizedItems.filter(d=>Array.isArray(d[o])?d[o].includes(s.value):d[o]===s.value);e=[...e,...i]})})}),this.getMaxItems(e)},authors(){return this.extractPropertyCounts("author")},topics(){return this.extractPropertyCounts("categories")},tags(){return this.extractPropertyCounts("tags")},dropdownCollection(){return[this.authors,this.topics,this.tags]}},setup(){const{locale:e}=z();return{locale:e}},created(){const e=_();e.setBlogItems(this.items),e.setBlogView(this.activeView)},beforeMount(){this.filterDropdowns=[...this.authors.length>0?[{label:this.$t("filterAuthors"),items:this.authors,key:"author"}]:[],{label:this.$t("filterTopics"),items:this.topics,key:"categories"},{label:this.$t("filterTags"),items:this.getFilteredTags(),key:"tags",filterable:!0}]},mounted(){window.addEventListener("resize",this.handleResize),this.handleResize()},beforeDestroy(){window.removeEventListener("resize",this.handleResize)},methods:{getFilteredTags(){var r;const e=p.getHash();if(!e)return this.tags;const t=(r=decodeURIComponent(e.substring(1)))==null?void 0:r.toLowerCase();return this.tags.map(o=>{var i;return((i=o==null?void 0:o.text)==null?void 0:i.toLowerCase())===t?(this.addTagToSelection(o),{...o,checked:!0}):o})},addTagToSelection(e,t){const s=t||this.dropdownCollection.length-1;this.selections[s]=[e]},getMaxItems(e){return e=[...new Set(e)],this.maxBlogPosts?e.slice(0,this.maxBlogPosts):e},handleResize(){this.itemStartPoint=p.isUpperBreakpoint()?1:0},extractPropertyCounts(e){return this.normalizedItems.reduce((s,r)=>(Array.isArray(r[e])?r[e].forEach(o=>{this.updatePropertyCount(s,o)}):r[e]&&this.updatePropertyCount(s,r[e]),s),[]).sort((s,r)=>s.text.localeCompare(r.text))},updatePropertyCount(e,t){const s=e.find(r=>{var o;return((o=r==null?void 0:r.text)==null?void 0:o.toLowerCase())===(t==null?void 0:t.toLowerCase())});s?s.count+=1:e.push({text:t,value:t,count:1})},handleView(e){this.activeView=e,_().setBlogView(this.activeView)},toggleIconClasses(e){return["filter-bar__toggle-icon",e===this.activeView?E.ACTIVE:""]},isArrayEmpty(e){return!Object.keys(e).length},isArrayEmptyRecursive(e){for(let t=0;t<e.length;t++){const s=e[t];if(s&&!this.isArrayEmpty(s))return!1}return!0},handleCardTagClicked(e){this.clearAllSelections(),this.getTagByName(e.toLowerCase())},getTagByName(e){this.tags.map(t=>{if(t.text.toLowerCase()===e){const s=this.filterDropdowns.length-1;this.addTagToSelection(t,s),this.updateDropdownSelection([t],s),this.hasClickedOnTag=!0}})},handleDropdownChange(e,t){e.length===0?this.selections[t]&&delete this.selections[t]:(this.hasClickedOnTag&&(this.hasClickedOnTag=!1,this.selections[t]=[]),this.selections[t]=e),this.isArrayEmptyRecursive(this.selections)&&(this.selections=[])},handleDropdownOpened(e){this.$refs.dropdowns.forEach(t=>{t!==e&&(t.isOpen=!1)})},clearAllSelections(){this.selections=[],this.$refs.dropdowns.forEach(e=>{e.isOpen=!1,e.activeSelection=[]})},removeSelection(e,t){if(e.preventDefault(),this.selections=this.selections.map(r=>r.filter(o=>o.value!==t.value)),this.selections.forEach((r,o)=>{this.updateDropdownSelection(r||[],o)}),this.selections.filter(r=>r.length>0).length===0)return this.clearAllSelections()},updateDropdownSelection(e,t){const s=this.$refs.dropdowns[t];s&&(s.activeSelection=e)}},data(){return{activeView:"tile-view",views:["tile-view","list-view"],filterDropdowns:[],selections:[],itemStartPoint:0,hasClickedOnTag:!1}},props:{spacing:String,items:String,maxBlogPosts:Number,dataAuthors:String}},N={class:"filter-bar"},V={class:"filter-bar__controls"},R={class:"filter-bar__selection"},F={class:"filter-bar__dropdowns"},M={class:"filter-bar__tags"},G={class:"filter-bar__views"},U={class:"filter-bar__toggle"},j=["onClick"];function H(e,t,s,r,o,i){var C;const d=y,S=x,w=T,k=D;return a(),c("div",N,[h("div",V,[h("div",R,[h("div",F,[(a(!0),c(m,null,f(o.filterDropdowns,(n,l)=>(a(),v(d,L({ref_for:!0},n,{onDropdownChanged:g=>i.handleDropdownChange(g,l),onDropdownOpened:i.handleDropdownOpened,ref_for:!0,ref:"dropdowns","has-animation":!0,key:l,index:l}),null,16,["onDropdownChanged","onDropdownOpened","index"]))),128))]),h("div",M,[(a(!0),c(m,null,f(i.flatSelections,(n,l)=>(a(),v(S,{class:"filter-bar__tag",tag:n.text,key:l,variant:"icon",onClick:g=>i.removeSelection(g,n)},null,8,["tag","onClick"]))),128)),i.flatSelections.length>=2?(a(),c("a",{key:0,class:"filter-bar__reset",onClick:t[0]||(t[0]=(...n)=>i.clearAllSelections&&i.clearAllSelections(...n))},[u(w,{icon:"close",size:"xs"}),B(" "+P((C=e.translationData)==null?void 0:C.clearAll),1)])):A("",!0)])]),h("div",G,[h("div",U,[(a(!0),c(m,null,f(o.views,(n,l)=>(a(),c("div",{class:O(i.toggleIconClasses(n)),onClick:g=>i.handleView(n),key:l},[u(w,{icon:n,size:"small"},null,8,["icon"])],10,j))),128))])])]),u(k,{items:i.filteredItems,view:o.activeView,"data-authors":s.dataAuthors,onCardTagClicked:i.handleCardTagClicked},null,8,["items","view","data-authors","onCardTagClicked"])])}const Y=I(b,[["render",H]]);b.__docgenInfo={exportName:"default",displayName:"filter-bar",description:"",tags:{},props:[{name:"spacing",type:{name:"string"}},{name:"items",type:{name:"string"}},{name:"maxBlogPosts",type:{name:"number"}},{name:"dataAuthors",type:{name:"string"}}],sourceFiles:["/home/runner/work/c4a8-web-shared-components/c4a8-web-shared-components/nuxt/components/filter-bar.vue"]};export{Y as F};
